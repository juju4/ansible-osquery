---
# tasks file for osquery

- name: Include distribution specific variables
  include_vars: "Debian.yml"
  when: ansible_distribution == "Ubuntu" or ansible_distribution == "Debian"
  tags:
    - osquery

- name: Include distribution specific variables
  include_vars: "CentOS.yml"
  when: ansible_distribution == "RedHat"
  tags:
    - osquery

- include: CentOS.yml
  when: ansible_os_family == "RedHat"
  tags:
    - osquery

- include: Debian.yml
  when: ansible_distribution == "Ubuntu" or ansible_distribution == "Debian"
  tags:
    - osquery

- name: Install osquery
  package:
    name: "{{ item }}"
    state: present
  with_items: "{{ osquery_packages }}"
  tags:
    - osquery

- name: Install osquery debug packages
  package:
    name: "{{ item }}"
    state: present
  with_items: "{{ osquery_debug_packages }}"
  when: osquery_debug_packages_install
  tags:
    - osquery

- block:
    - include: configure.yml
      tags:
        - osquery
        - config

    - name: Enable osqueryd service
      service: 
        name: osqueryd 
        enabled: "{{ osquery_service_enable }}"
      tags:
        - osquery
        - service

    - name: Start osqueryd service
      service: 
        name: osqueryd 
        state: started
      when: osquery_service_enable
      tags:
        - osquery
        - service

- include: testing.yml
  when: osquery_testing

- include: profiling.yml
  when: osquery_profiling
